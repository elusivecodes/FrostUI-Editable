!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Editable requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Editable requires FrostUI.");const e=t.Core,s=t.dom,i=(t.QuerySet,t.UI);t.document;class n extends i.BaseComponent{constructor(t,i){super(t,i),this._value=null===this._settings.value?s.getText(this._node):this._settings.value,this._enabled=!0,this._getLabel=t=>{if(this._settings.getLabel)return this._settings.getLabel(this._value,this._input,this);if(this._selectmenu){const t=this._selectmenu.data();return t?t.text:null}if("select"!==this._settings.type)return this._value;if(!e.isArray(this._value)){const t=s.findOne(`option[value="${this._value}"]`,this._input);return t?s.getText(t):null}const i=[];for(const t of this._value){const e=s.findOne(`option[value="${t}"]`,this._input),n=s.getText(e);i.push(n)}return i.length?i.join(this._settings.separator):null},this._buildForm(),this._buildLoader(),this._events(),this._refresh(!0)}dispose(){s.removeEvent(this._node,"click.ui.editable"),this._value?s.removeClass(this._node,"editable"):s.removeClass(this._node,"editable-empty"),s.remove(this._form),s.show(this._node),this._selectmenu?this._selectmenu.dispose():this._datetimepicker?this._datetimepicker.dispose():this._autocomplete&&this._autocomplete.dispose(),super.dispose()}disable(){return this._enabled=!1,this._refresh(),s.detach(this._form),s.show(this._node),this}enable(){return this._enabled=!0,this._refresh(),this}getValue(){return this._value}hide(){return s.detach(this._form),s.show(this._node),s.setHTML(this._error,""),s.hide(this._error),s.removeClass(this._form,this.constructor.classes.formError),s.triggerEvent(this._node,"hidden.ui.editable"),this}setValue(t){return this._enabled&&(this._value=t,s.isConnected(this._form)?this._updateValue():this._refresh()),this}show(){return s.before(this._node,this._form),s.hide(this._node),s.focus(this._input),s.triggerEvent(this._node,"shown.ui.editable"),this}toggle(){return s.isConnected(this._form)?this.hide():this.show()}}Object.assign(n.prototype,{_events(){s.addEvent(this._node,"click.ui.editable",t=>{this._enabled&&(t.preventDefault(),this._updateValue(),this.show())}),s.addEvent(this._form,"submit.ui.editable",t=>{t.preventDefault();const e=this._settings.getValue?this._settings.getValue(this._input,this):s.getValue(this._input);if(this._settings.validate){const t=this._settings.validate(e,this._input,this);if(t)return s.setHTML(this._error,t),s.show(this._error),void s.addClass(this._form,this.constructor.classes.formError)}if(e===this._value)return void this.hide();const i=this._settings.saveValue(e,this._input,this);s.before(this._node,this._loader),s.hide(this._form),Promise.resolve(i).then(t=>{this._value=e,this._refresh(),this.hide(),s.triggerEvent(this._node,"saved.ui.editable")}).catch(t=>{}).finally(t=>{s.detach(this._loader),s.show(this._form)})}),this._settings.buttons?s.addEvent(this._cancel,"click.ui.editable",t=>{t.preventDefault(),this.hide()}):s.addEvent(this._input,"change.ui.editable blur.ui.editable",t=>{s.triggerEvent(this._form,"submit.ui.editable")})}}),Object.assign(n.prototype,{_refresh(t=!1){s.removeClass(this._node,this.constructor.classes.empty),s.removeClass(this._node,this.constructor.classes.editable),this._enabled&&Promise.resolve(this._getLabel()).then(e=>{if(!e&&t&&(e=s.getText(this._node)),!e)return s.setText(this._node,this._settings.emptyText),void s.addClass(this._node,this.constructor.classes.empty);s.setText(this._node,e),s.addClass(this._node,this.constructor.classes.editable)})},_updateValue(){this._settings.setValue?this._settings.setValue(this._input,this._value,this):this._selectmenu?this._selectmenu.setValue(this._value):this._datetimepicker?this._datetimepicker.setDate(this._value):s.setValue(this._input,this._value)}}),Object.assign(n.prototype,{_buildForm(){if(this._form=s.create("form"),this._inputGroup=s.create("div",{class:"filled"===this._settings.inputStyle?this.constructor.classes.inputGroupFilled:this.constructor.classes.inputGroupOutline}),s.append(this._form,this._inputGroup),this._renderInput(),this._settings.buttons)if(this._submit=s.create("button",{html:this._settings.lang.save,class:this.constructor.classes.saveButton,attributes:{type:"submit"}}),this._cancel=s.create("button",{html:this._settings.lang.cancel,class:this.constructor.classes.cancelButton,attributes:{type:"button"}}),"bottom"===this._settings.buttons){const t=s.create("div",{class:"mt-1"});s.append(this._form,t),s.addClass(this._submit,"me-1"),s.append(t,this._submit),s.append(t,this._cancel)}else s.append(this._inputGroup,this._submit),s.append(this._inputGroup,this._cancel);this._error=s.create("div",{class:this.constructor.classes.error}),s.append(this._form,this._error),s.hide(this._error),this._settings.initInput?this._settings.initInput(this._input,this):this._settings.selectmenu?this._selectmenu=i.SelectMenu.init(this._input,this._settings.selectmenu):this._settings.datetimepicker?this._datetimepicker=i.DateTimePicker.init(this._input,this._settings.datetimepicker):this._settings.autocomplete&&(this._autocomplete=i.Autocomplete.init(this._input,this._settings.autocomplete))},_buildLoader(){this._loader=s.create("span",{class:this.constructor.classes.spinner})},_renderInput(){const t=s.create("div",{class:this.constructor.classes.inputContainer});s.append(this._inputGroup,t);const e={};let i;switch(this._settings.type){case"select":case"textarea":i=this._settings.type;break;default:i="input",e.type=this._settings.type}if(this._input=s.create(i,{class:"filled"===this._settings.inputStyle?this.constructor.classes.inputFilled:this.constructor.classes.inputOutline,attributes:{...e,...this._settings.inputAttributes}}),this._settings.inputClass&&s.addClass(this._input,this._settings.inputClass),s.append(t,this._input),"select"===this._settings.type&&this._settings.data)for(const t of this._settings.data){const e=s.create("option",{text:t.text,attributes:{value:t.value}});s.append(this._input,e)}if("filled"===this._settings.inputStyle){const e=s.create("div",{class:this.constructor.classes.inputRipple});s.append(t,e)}}}),n.defaults={type:"text",value:null,emptyText:"Empty",separator:", ",inputAttributes:{},inputClass:null,inputStyle:"filled",lang:{save:"Save",cancel:"Cancel"},buttons:!0,getLabel:null,getValue:null,initInput:null,saveValue:t=>{},setValue:null,validate:null,autocomplete:null,selectmenu:null,datetimepicker:null},n.classes={cancelButton:"btn btn-danger ripple",editable:"editable",empty:"editable-empty",error:"invalid-feedback",formError:"form-error",inputContainer:"form-input",inputFilled:"input-filled",inputGroupFilled:"input-group input-group-filled",inputGroupOutline:"input-group input-group-outline",inputOutline:"input-outline",inputRipple:"ripple-line",saveButton:"btn btn-success ripple",spinner:"spinner-border spinner-border-sm text-primary"},i.initComponent("editable",n),i.Editable=n}));